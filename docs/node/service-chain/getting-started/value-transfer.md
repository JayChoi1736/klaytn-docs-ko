This section will explain how to enable ERC-20 value transfer between Baobab network and your service chain with the provided test code. You will add KLAY to the operator account and deploy bridge and ERC-20 contracts. Then you will register the contract address on SCN. And you will test an ERC-20 value transferring.


## 준비 사항 <a id="prerequisites"></a>
- 서비스체인을 설치하고 서비스체인을 Baobab EN에 연결했다고 가정합니다 ([참고 링크](en-scn-connection.md)).
- Download the code for contract deployment and transfer. ([download](https://drive.google.com/file/d/14tNU-jOAv7JwfY5xZqJlckkpO16TuS2S/view?usp=sharing))
- `Node.js(v10.60.0)`과 `npm`을 설치하세요 ([설치방법](https://nodejs.org/en/download/package-manager/))


## ERC-20 토큰 전송<a id="erc-20-token-transfer"></a>

### 1 단계 : 운영자 계정에 KLAY 추가하기<a id="step-1-add-klay-to-the-operator-accounts"></a>
SCN에 연결하여 `subbridge.parentOperator`와 `subbridge.childOperator`를 실행하여 계정 주소를 확인하세요.
```
$ kscn attach --datadir ~/data
> subbridge.childOperator
"0x10221f7f9355017cd0c11444e7eecb99621bacce"
> subbridge.parentOperator
"0x3ce216beeafc62d20547376396e89528e1d778ca"
```

Create a test account on a [Baobab Wallet](https://baobab.wallet.klaytn.com/) and get test KLAY from the faucet. Then send 1 KLAY to the `parentOperator`. `childOperator` has to get KLAY from the test account generated by `homi` ([Refer to EN Setup and SCN Connection Guide](en-scn-connection.md)).

```
$ kscn account import ~/homi-output/keys_test/testkey1
Your new account is locked with a password. Please give a password. Do not forget this password.
Passphrase:
Repeat passphrase:
Address: {80119c31cdae67c42c8296929bb4f89b2a52cec4}
```
```
$ kscn attach --datadir ~/data
> personal.unlockAccount("80119c31cdae67c42c8296929bb4f89b2a52cec4")
Unlock account 80119c31cdae67c42c8296929bb4f89b2a52cec4
Passphrase:
True
> klay.sendTransaction({from:"80119c31cdae67c42c8296929bb4f89b2a52cec4", to:subbridge.childOperator, value: web3.toPeb(1000, "KLAY")})
"0x84caab84ebf0c4bb4ecf0a7849f1de3e479f1863a95f70c51047a7ca7bc64b33"
```
오퍼레이터 계정의 잔액이 충분한지 확인하세요.
```
> klay.getBalance(subbridge.childOperator)
1e+21
> klay.getBalance(subbridge.parentOperator)
1e+18
```

### 2 단계 : 컨트랙트 배포 <a id="step-2-deploy-contracts"></a>
Connect to the SCN and prepare the node environment for contract deployment. [Download `deploy_and_test.tar.gz`](https://drive.google.com/file/d/14tNU-jOAv7JwfY5xZqJlckkpO16TuS2S/view?usp=sharing) and extract it to node_project directory.

```bash
$ mkdir node_project
$ cd node_project
$ npm init
$ npm install caver-js
$ tar xvfz /path/to/deploy_and_transfer.tar.gz -C .
```

텍스트 편집기에서 `deploy_conf.json`을 아래와 같이 편집하세요.
- Replace `ip` and `port` in the `scn` section with the actual values of your SCN. The port is RPC_PORT in kscnd.conf. The default configuration is using port 7551.
- `key`를 `homi`가 생성한 `testkey1`로 변경하세요.
- `operator`를 이전 단계에서 확인한 `subbridge.childOperator` 주소로 지정하세요.
- Replace `ip` and `port` in the `en` section with the actual values of your EN. The port is RPC_PORT in kend.conf. The default configuration is using port 8551.
- `key`를 이전 단계에서 [Baobab Wallet](https://baobab.wallet.klaytn.com/)에서 생성한 테스트 계정의 개인키로 변경하세요 .
- `operator`를 이전 단계에서 확인한 `subbridge.parentOperator` 주소로 지정하세요.

```
{
     "scn" : {
         "ip": "192.168.0.1",
         "port": "7551",
         "key": "0x66cb283353589a10866b58d388e9d956e5a9c873a8c78fa4411d460c19c494ea",
         "operator": "0x10221f7f9355017cd0c11444e7eecb99621bacce"
     },
     "en" : {
         "ip": "192.168.0.5",
         "port": "8551",
         "key": "0x26f4b5ac42ceabcfd3b23a991fdbfc792d10ce700a99582fdf9185a8f163b790",
         "operator": "0x3ce216beeafc62d20547376396e89528e1d778ca"
     }
 }
```

Perform token deployment with `node deploy.js` command. It will show an API list to perform at the next step.

```
$ node deploy.js
subbridge.registerBridge("0x5f093de8a1b1d32Fc4cF6F40357DCcD24453BAb3", "0xD1C4808960Fb4581b9A5B3B217b9a67057D84c19")
subbridge.subscribeBridge("0x5f093de8a1b1d32Fc4cF6F40357DCcD24453BAb3", "0xD1C4808960Fb4581b9A5B3B217b9a67057D84c19")
subbridge.registerToken("0x5f093de8a1b1d32Fc4cF6F40357DCcD24453BAb3", "0xD1C4808960Fb4581b9A5B3B217b9a67057D84c19", "0x96272131600EC7c64c45CE139C32F4919fBFaDC8", "0xc7858a153376764208e8F6B6B55B4a0792B67c3E")
```

### 3 단계 : 브리지 등록, 브리지 구독, 토큰 등록 <a id="step-3-register-bridge-subscribe-bridge-and-register-token"></a>
콘솔에서 위에 표시된 API를 하나씩 실행하세요.
```
$ kscn attach --datadir ~/data
> subbridge.registerBridge("0x5f093de8a1b1d32Fc4cF6F40357DCcD24453BAb3", "0xD1C4808960Fb4581b9A5B3B217b9a67057D84c19")
null
> subbridge.subscribeBridge("0x5f093de8a1b1d32Fc4cF6F40357DCcD24453BAb3", "0xD1C4808960Fb4581b9A5B3B217b9a67057D84c19")
null
> subbridge.registerToken("0x5f093de8a1b1d32Fc4cF6F40357DCcD24453BAb3", "0xD1C4808960Fb4581b9A5B3B217b9a67057D84c19", "0x96272131600EC7c64c45CE139C32F4919fBFaDC8", "0xc7858a153376764208e8F6B6B55B4a0792B67c3E")
null
```

### 4 단계 : 토큰 전송<a id="step-4-token-transfer"></a>
`node transfer.js` 명령어로 토큰을 전송하세요.
```
$ node transfer.js
requestValueTransfer..
alice balance: 100
```

결과가 `alice balance: 100`인지 확인하세요.
